# 协程池设计

## 背景
虽然goroutine创建成本很低(内存仅占用2k)，可是如果不加控制，创建大量goroutine，内存占用会越来越高，极端情况下可能会导致OOM，而且大量的goroutine上下文切换，调度也会成为性能瓶颈。

## 开源实现
### fast-http
net/http库为每个连接分配2个goroutine，分别负责读写请求。随着连接数的增长, goroutine被大量创建，尤其在http短连接场景下，大量goroutine存在频繁的上下文切换，影响服务性能。fasthttp库通过协程池实现`复用`协程, 并且模块设计非常清晰易理解，除此之外作者也做了很多极致的内存优化，非常值得学习。

### ants
高性能的goroutine协程池,支持多种模式，是目前主流的协程池，同时也是非常好的学习资源。

综上纵使业界有不少成熟的组件，可是作为工程师不能存在拿来主义，要知其所以然，需要重点掌握`资源复用`的思想。

## 设计要点
- 创建有限的goroutine
- 复用goroutine
- 支持自动扩缩

