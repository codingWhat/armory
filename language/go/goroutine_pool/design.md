# 协程池设计

## 背景
虽然goroutine创建成本很低(内存仅占用2k)，可是如果在高并发请求场景下不加控制创建大量goroutine，内存占用越来愈高，极端情况可能会OOM. 除此之外大量的goroutine上下文切换，调度也会成为性能瓶颈。

## 开源实现
### fast-http
net/http库中每个连接2个goroutine，分别负责读写，可是当连接来到10w+, goroutine被大量创建，fasthttp库通过实现`worker-pool`，复用协程。并且在在保证整体简单的基础上，作者做了很多性能优化，值得学习。

### ants
高性能的goroutine协程池,支持多种模式，是目前主流的协程池，同时也是非常好的学习资源。

综上纵使业界有不少成熟的组件，可是作为工程师不能存在拿来主义，要知其所以然，需要重点掌握`资源复用`的思想。

## 设计要点
- 创建有限的goroutine
- 复用goroutine
- 支持自动扩缩

